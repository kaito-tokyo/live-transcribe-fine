diff --git a/CMakeLists.txt b/CMakeLists.txt
index 886af19c6..71168ce7d 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -98,9 +98,11 @@ if(CONDA_ROOT)
     endif()
 else()
     if(MATHLIB STREQUAL "OpenBLAS")
+        find_package(OpenBLAS REQUIRED)
+        find_package(LAPACK REQUIRED)
         add_definitions(-DHAVE_CLAPACK=1)
         include_directories(${CMAKE_CURRENT_SOURCE_DIR}/tools/CLAPACK)
-        link_libraries(${BLAS_LIBRARIES} ${LAPACK_LIBRARIES})
+        link_libraries(OpenBLAS::OpenBLAS LAPACK::LAPACK)
     elseif(MATHLIB STREQUAL "MKL")
         if(NOT DEFINED ENV{MKLROOT} OR "$ENV{MKLROOT}" STREQUAL "")
             message(FATAL_ERROR "Environment variable MKLROOT is not defined")
@@ -154,9 +156,6 @@ if(MSVC)
         CMAKE_C_FLAGS_DEBUG
         CMAKE_C_FLAGS_RELEASE
         )
-    foreach(CompilerFlag ${CompilerFlags})
-      string(REPLACE "/MD" "/MT" ${CompilerFlag} "${${CompilerFlag}}")
-    endforeach()
     set(CUDA_USE_STATIC_CUDA_RUNTIME OFF CACHE INTERNAL "")
     if(NOT DEFINED ENV{CUDAHOSTCXX})
         set(ENV{CUDAHOSTCXX} ${CMAKE_CXX_COMPILER})
@@ -228,7 +227,8 @@ endif()
 #            PATHS "${CMAKE_CURRENT_SOURCE_DIR}/tools/openfst/include"
 #            REQUIRED)
 
-link_libraries(fst)
+find_package(OpenFst REQUIRED)
+link_libraries(OpenFst::fst OpenFst::fstfar OpenFst::fstngram OpenFst::fstlookahead)
 
 # add all native libraries
 add_subdirectory(src/base) # NOTE, we need to patch the target with version from outside
@@ -299,9 +299,9 @@ if(NOT CONDA_ROOT)
     include(CMakePackageConfigHelpers)
     # maybe we should put this into subfolder?
     configure_package_config_file(
-        ${CMAKE_CURRENT_SOURCE_DIR}/cmake/kaldi-config.cmake.in
+        ${CMAKE_CURRENT_SOURCE_DIR}/cmake/kaldi-config.cmake.${MATHLIB}.in
         ${CMAKE_CURRENT_BINARY_DIR}/cmake/kaldi-config.cmake
-        INSTALL_DESTINATION lib/cmake/kaldi
+        INSTALL_DESTINATION share/kaldi
     )
     write_basic_package_version_file(
         ${CMAKE_CURRENT_BINARY_DIR}/cmake/kaldi-config-version.cmake
@@ -309,7 +309,7 @@ if(NOT CONDA_ROOT)
         COMPATIBILITY AnyNewerVersion
     )
     install(FILES ${CMAKE_CURRENT_BINARY_DIR}/cmake/kaldi-config.cmake ${CMAKE_CURRENT_BINARY_DIR}/cmake/kaldi-config-version.cmake
-        DESTINATION lib/cmake/kaldi
+        DESTINATION share/kaldi
     )
-    install(EXPORT kaldi-targets DESTINATION ${CMAKE_INSTALL_PREFIX}/lib/cmake/kaldi)
+    install(EXPORT kaldi-targets NAMESPACE kaldi:: DESTINATION ${CMAKE_INSTALL_PREFIX}/share/kaldi)
 endif()
diff --git a/cmake/VersionHelper.cmake b/cmake/VersionHelper.cmake
index c3780ee69..ec07b0e5b 100644
--- a/cmake/VersionHelper.cmake
+++ b/cmake/VersionHelper.cmake
@@ -1,15 +1,39 @@
 function(get_version)
-    file(READ ${CMAKE_CURRENT_SOURCE_DIR}/src/.version version)
-    string(STRIP ${version} version)
-    execute_process(COMMAND git log -n1 --format=%H src/.version
-                    WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}
-                    OUTPUT_VARIABLE version_commit
-                    OUTPUT_STRIP_TRAILING_WHITESPACE)
-    execute_process(COMMAND git rev-list --count "${version_commit}..HEAD"
-                    WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}
-                    OUTPUT_VARIABLE patch_number)
-    string(STRIP ${patch_number} patch_number)
+    set(_version_file "${CMAKE_CURRENT_SOURCE_DIR}/src/.version")
+    if(EXISTS "${_version_file}")
+        file(READ "${_version_file}" version)
+        string(STRIP "${version}" version)
+    else()
+        set(version "unknown")
+    endif()
 
-    set(KALDI_VERSION ${version} PARENT_SCOPE)
-    set(KALDI_PATCH_NUMBER ${patch_number} PARENT_SCOPE)
+    execute_process(
+        COMMAND git log -n1 --format=%H src/.version
+        WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}
+        OUTPUT_VARIABLE version_commit
+        RESULT_VARIABLE git_log_result
+        OUTPUT_STRIP_TRAILING_WHITESPACE
+        ERROR_QUIET
+    )
+
+    if(git_log_result EQUAL 0 AND NOT "${version_commit}" STREQUAL "")
+        execute_process(
+            COMMAND git rev-list --count "${version_commit}..HEAD"
+            WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}
+            OUTPUT_VARIABLE patch_number
+            RESULT_VARIABLE git_revlist_result
+            OUTPUT_STRIP_TRAILING_WHITESPACE
+            ERROR_QUIET
+        )
+        if(git_revlist_result EQUAL 0)
+            string(STRIP "${patch_number}" patch_number)
+        else()
+            set(patch_number "0")
+        endif()
+    else()
+        set(patch_number "0")
+    endif()
+
+    set(KALDI_VERSION "${version}" PARENT_SCOPE)
+    set(KALDI_PATCH_NUMBER "${patch_number}" PARENT_SCOPE)
 endfunction()
diff --git a/cmake/kaldi-config.cmake.in b/cmake/kaldi-config.cmake.Accelerate.in
similarity index 56%
rename from cmake/kaldi-config.cmake.in
rename to cmake/kaldi-config.cmake.Accelerate.in
index 123f58c56..7cec6a9a0 100644
--- a/cmake/kaldi-config.cmake.in
+++ b/cmake/kaldi-config.cmake.Accelerate.in
@@ -1,6 +1,8 @@
 @PACKAGE_INIT@
 
-find_package(Threads)
+include(CMakeFindDependencyMacro)
+find_dependency(OpenFst)
+find_dependency(Threads)
 
 if(NOT TARGET kaldi-base)
     include(${CMAKE_CURRENT_LIST_DIR}/kaldi-targets.cmake)
diff --git a/cmake/kaldi-config.cmake.OpenBLAS.in b/cmake/kaldi-config.cmake.OpenBLAS.in
new file mode 100644
index 000000000..dbad66227
--- /dev/null
+++ b/cmake/kaldi-config.cmake.OpenBLAS.in
@@ -0,0 +1,11 @@
+@PACKAGE_INIT@
+
+include(CMakeFindDependencyMacro)
+find_dependency(OpenFst)
+find_dependency(Threads)
+find_dependency(OpenBLAS)
+find_dependency(LAPACK)
+
+if(NOT TARGET kaldi-base)
+    include(${CMAKE_CURRENT_LIST_DIR}/kaldi-targets.cmake)
+endif()
